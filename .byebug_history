continue
model.certificates_tokens[]
model.certificates_tokens
model
model.certificates_tokens
model.order
model[:certificates_tokens]
model.certificates_tokens
model
continue
model.class.super
model.super
model.class
model
continue
next
continue
next
continue
next
errors
next
step
next
continue
order.errors
order.valid?
next
order.valid?
next
continue
next
continue
order.errors
order.valid?
order.errors
next
q
order.errors
order.valid?
next
certificates_are_valid
continue
order.gift_certificates
order
order.certificate_tokens
order.certificates_tokens
order.errors
order.valid?
next
certificates_are_valid
continue
next
certificates_are_valid
continue
step
continue
resource_params
continue
resource_params
continue
resource_params
continue
resource_params
continue
resource_params
continue
next
continue
@certtificates_tokens.to_a - GiftCertificate.unordered.map(&:token)
@certtificates_tokens
GiftCertificate.unordered.map(&:token)
continue
params
current_user
next
current_user
continue
next
certificates_payment_amount
next
continue
next
continue
exception
next
order.gift_certificates
order
next
used_certificates
next
continue
next
bonuses_payment_amount
next
used_certificates
certificates_payment_amount
next
continue
next
continue
next
continue
next
received_bonuses
next
bonuses_payment_amount
next
amount_left_to_pay
next
certificates_payment_amount
next
continue
next
current_user.gift_certificates
next
current_user.gift_certificates
next
current_user
next
current_user.gift_certificates
q
next
current_user.gift_certificates
next
amount_left_to_pay
current_user
next
current_user
next
bonuses_payment_amount
next
certificates_payment_amount
next
amount_left_to_pay
next
q
q y
GiftCertificate.unordered.where(token: @certtificates_tokens)q y
GiftCertificate.unordered.where(token: @certtificates_tokens)
GiftCertificate.unordered
next
q
(@certtificates_tokens - GiftCertificate.unordered.map(&:token)).empty?
@certtificates_tokens - GiftCertificate.unordered.map(&:token)
(GiftCertificate.all.map(&:token)-@certtificates_tokens).count
(GiftCertificate.all.map(&:token)-@certtificates_tokens)
GiftCertificate.all.map(&:token)-@certtificates_tokens
GiftCertificate.all.map(&:token).count
@certtificates_tokens - GiftCertificate.all.map(&:token)
GiftCertificate.all.map(&:token)
GiftCertificate.all.map
@certtificates_tokens[0]
GiftCertificate.all.include? @certtificates_tokens[0]
GiftCertificate.all.tokens
GiftCertificate.all.token
GiftCertificate.all
@certtificates_tokens.count
@certtificates_tokens
q
@certtificates_tokens.count
@certtificates_tokens
continue
@certtificates_tokens
certtificates_tokens
continue
next
current_user
order
next
current_user
order
bonuses_payment_amount
next
continue
next
gift_certificate
next
continue
next
continue
params[:quantity].to_i
params
continue
step
continue
step
next
continue
current_user.bonus_points
continue
current_user.bonus_points
current_user.bonus_points - bonuses_payment_amount + real_cash_amount * 0.04
bonuses_payment_amount + real_cash_amount * 0.04
   21:                           - bonuses_payment_amount + real_cash_amount * 0.04
current_user.bonus_points
next
current_user.bonus_points
next
real_cash_amount * 0.04
real_cash_amount
bonuses_payment_amount
current_user.bonus_points
next
continue
next
pay_with_bonuses
next
continue
order.status != "Pending"
order.status
ordet.status
next
order
next
continue
Order.find_by!(id: params[:id])
Order.find!(params[:id])
Order.find_by!(params[:id])
Order.find_by!(params[id])
resource resource_params
params
@order
self.status
self.class
self
resource
continue
params[:user][:amount]
params
current_user
continue
current_user
params
continue
resource_params
params
current_user
continue
current_user
params[:amount].to_i
params[:amount]
params
continue
params
exit
purchase
q
params["purchase"]["quantity"].to_i
currPurchase.quantity
params
q
next
currPurchase
q
currPurchase
